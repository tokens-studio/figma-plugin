
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for src/utils/TokenResolver.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../index.html">All files</a> / <a href="index.html">src/utils</a> TokenResolver.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/130</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/115</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/8</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/129</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input oninput="onInput()" type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a>
<a name='L155'></a><a href='#L155'>155</a>
<a name='L156'></a><a href='#L156'>156</a>
<a name='L157'></a><a href='#L157'>157</a>
<a name='L158'></a><a href='#L158'>158</a>
<a name='L159'></a><a href='#L159'>159</a>
<a name='L160'></a><a href='#L160'>160</a>
<a name='L161'></a><a href='#L161'>161</a>
<a name='L162'></a><a href='#L162'>162</a>
<a name='L163'></a><a href='#L163'>163</a>
<a name='L164'></a><a href='#L164'>164</a>
<a name='L165'></a><a href='#L165'>165</a>
<a name='L166'></a><a href='#L166'>166</a>
<a name='L167'></a><a href='#L167'>167</a>
<a name='L168'></a><a href='#L168'>168</a>
<a name='L169'></a><a href='#L169'>169</a>
<a name='L170'></a><a href='#L170'>170</a>
<a name='L171'></a><a href='#L171'>171</a>
<a name='L172'></a><a href='#L172'>172</a>
<a name='L173'></a><a href='#L173'>173</a>
<a name='L174'></a><a href='#L174'>174</a>
<a name='L175'></a><a href='#L175'>175</a>
<a name='L176'></a><a href='#L176'>176</a>
<a name='L177'></a><a href='#L177'>177</a>
<a name='L178'></a><a href='#L178'>178</a>
<a name='L179'></a><a href='#L179'>179</a>
<a name='L180'></a><a href='#L180'>180</a>
<a name='L181'></a><a href='#L181'>181</a>
<a name='L182'></a><a href='#L182'>182</a>
<a name='L183'></a><a href='#L183'>183</a>
<a name='L184'></a><a href='#L184'>184</a>
<a name='L185'></a><a href='#L185'>185</a>
<a name='L186'></a><a href='#L186'>186</a>
<a name='L187'></a><a href='#L187'>187</a>
<a name='L188'></a><a href='#L188'>188</a>
<a name='L189'></a><a href='#L189'>189</a>
<a name='L190'></a><a href='#L190'>190</a>
<a name='L191'></a><a href='#L191'>191</a>
<a name='L192'></a><a href='#L192'>192</a>
<a name='L193'></a><a href='#L193'>193</a>
<a name='L194'></a><a href='#L194'>194</a>
<a name='L195'></a><a href='#L195'>195</a>
<a name='L196'></a><a href='#L196'>196</a>
<a name='L197'></a><a href='#L197'>197</a>
<a name='L198'></a><a href='#L198'>198</a>
<a name='L199'></a><a href='#L199'>199</a>
<a name='L200'></a><a href='#L200'>200</a>
<a name='L201'></a><a href='#L201'>201</a>
<a name='L202'></a><a href='#L202'>202</a>
<a name='L203'></a><a href='#L203'>203</a>
<a name='L204'></a><a href='#L204'>204</a>
<a name='L205'></a><a href='#L205'>205</a>
<a name='L206'></a><a href='#L206'>206</a>
<a name='L207'></a><a href='#L207'>207</a>
<a name='L208'></a><a href='#L208'>208</a>
<a name='L209'></a><a href='#L209'>209</a>
<a name='L210'></a><a href='#L210'>210</a>
<a name='L211'></a><a href='#L211'>211</a>
<a name='L212'></a><a href='#L212'>212</a>
<a name='L213'></a><a href='#L213'>213</a>
<a name='L214'></a><a href='#L214'>214</a>
<a name='L215'></a><a href='#L215'>215</a>
<a name='L216'></a><a href='#L216'>216</a>
<a name='L217'></a><a href='#L217'>217</a>
<a name='L218'></a><a href='#L218'>218</a>
<a name='L219'></a><a href='#L219'>219</a>
<a name='L220'></a><a href='#L220'>220</a>
<a name='L221'></a><a href='#L221'>221</a>
<a name='L222'></a><a href='#L222'>222</a>
<a name='L223'></a><a href='#L223'>223</a>
<a name='L224'></a><a href='#L224'>224</a>
<a name='L225'></a><a href='#L225'>225</a>
<a name='L226'></a><a href='#L226'>226</a>
<a name='L227'></a><a href='#L227'>227</a>
<a name='L228'></a><a href='#L228'>228</a>
<a name='L229'></a><a href='#L229'>229</a>
<a name='L230'></a><a href='#L230'>230</a>
<a name='L231'></a><a href='#L231'>231</a>
<a name='L232'></a><a href='#L232'>232</a>
<a name='L233'></a><a href='#L233'>233</a>
<a name='L234'></a><a href='#L234'>234</a>
<a name='L235'></a><a href='#L235'>235</a>
<a name='L236'></a><a href='#L236'>236</a>
<a name='L237'></a><a href='#L237'>237</a>
<a name='L238'></a><a href='#L238'>238</a>
<a name='L239'></a><a href='#L239'>239</a>
<a name='L240'></a><a href='#L240'>240</a>
<a name='L241'></a><a href='#L241'>241</a>
<a name='L242'></a><a href='#L242'>242</a>
<a name='L243'></a><a href='#L243'>243</a>
<a name='L244'></a><a href='#L244'>244</a>
<a name='L245'></a><a href='#L245'>245</a>
<a name='L246'></a><a href='#L246'>246</a>
<a name='L247'></a><a href='#L247'>247</a>
<a name='L248'></a><a href='#L248'>248</a>
<a name='L249'></a><a href='#L249'>249</a>
<a name='L250'></a><a href='#L250'>250</a>
<a name='L251'></a><a href='#L251'>251</a>
<a name='L252'></a><a href='#L252'>252</a>
<a name='L253'></a><a href='#L253'>253</a>
<a name='L254'></a><a href='#L254'>254</a>
<a name='L255'></a><a href='#L255'>255</a>
<a name='L256'></a><a href='#L256'>256</a>
<a name='L257'></a><a href='#L257'>257</a>
<a name='L258'></a><a href='#L258'>258</a>
<a name='L259'></a><a href='#L259'>259</a>
<a name='L260'></a><a href='#L260'>260</a>
<a name='L261'></a><a href='#L261'>261</a>
<a name='L262'></a><a href='#L262'>262</a>
<a name='L263'></a><a href='#L263'>263</a>
<a name='L264'></a><a href='#L264'>264</a>
<a name='L265'></a><a href='#L265'>265</a>
<a name='L266'></a><a href='#L266'>266</a>
<a name='L267'></a><a href='#L267'>267</a>
<a name='L268'></a><a href='#L268'>268</a>
<a name='L269'></a><a href='#L269'>269</a>
<a name='L270'></a><a href='#L270'>270</a>
<a name='L271'></a><a href='#L271'>271</a>
<a name='L272'></a><a href='#L272'>272</a>
<a name='L273'></a><a href='#L273'>273</a>
<a name='L274'></a><a href='#L274'>274</a>
<a name='L275'></a><a href='#L275'>275</a>
<a name='L276'></a><a href='#L276'>276</a>
<a name='L277'></a><a href='#L277'>277</a>
<a name='L278'></a><a href='#L278'>278</a>
<a name='L279'></a><a href='#L279'>279</a>
<a name='L280'></a><a href='#L280'>280</a>
<a name='L281'></a><a href='#L281'>281</a>
<a name='L282'></a><a href='#L282'>282</a>
<a name='L283'></a><a href='#L283'>283</a>
<a name='L284'></a><a href='#L284'>284</a>
<a name='L285'></a><a href='#L285'>285</a>
<a name='L286'></a><a href='#L286'>286</a>
<a name='L287'></a><a href='#L287'>287</a>
<a name='L288'></a><a href='#L288'>288</a>
<a name='L289'></a><a href='#L289'>289</a>
<a name='L290'></a><a href='#L290'>290</a>
<a name='L291'></a><a href='#L291'>291</a>
<a name='L292'></a><a href='#L292'>292</a>
<a name='L293'></a><a href='#L293'>293</a>
<a name='L294'></a><a href='#L294'>294</a>
<a name='L295'></a><a href='#L295'>295</a>
<a name='L296'></a><a href='#L296'>296</a>
<a name='L297'></a><a href='#L297'>297</a>
<a name='L298'></a><a href='#L298'>298</a>
<a name='L299'></a><a href='#L299'>299</a>
<a name='L300'></a><a href='#L300'>300</a>
<a name='L301'></a><a href='#L301'>301</a>
<a name='L302'></a><a href='#L302'>302</a>
<a name='L303'></a><a href='#L303'>303</a>
<a name='L304'></a><a href='#L304'>304</a>
<a name='L305'></a><a href='#L305'>305</a>
<a name='L306'></a><a href='#L306'>306</a>
<a name='L307'></a><a href='#L307'>307</a>
<a name='L308'></a><a href='#L308'>308</a>
<a name='L309'></a><a href='#L309'>309</a>
<a name='L310'></a><a href='#L310'>310</a>
<a name='L311'></a><a href='#L311'>311</a>
<a name='L312'></a><a href='#L312'>312</a>
<a name='L313'></a><a href='#L313'>313</a>
<a name='L314'></a><a href='#L314'>314</a>
<a name='L315'></a><a href='#L315'>315</a>
<a name='L316'></a><a href='#L316'>316</a>
<a name='L317'></a><a href='#L317'>317</a>
<a name='L318'></a><a href='#L318'>318</a>
<a name='L319'></a><a href='#L319'>319</a>
<a name='L320'></a><a href='#L320'>320</a>
<a name='L321'></a><a href='#L321'>321</a>
<a name='L322'></a><a href='#L322'>322</a>
<a name='L323'></a><a href='#L323'>323</a>
<a name='L324'></a><a href='#L324'>324</a>
<a name='L325'></a><a href='#L325'>325</a>
<a name='L326'></a><a href='#L326'>326</a>
<a name='L327'></a><a href='#L327'>327</a>
<a name='L328'></a><a href='#L328'>328</a>
<a name='L329'></a><a href='#L329'>329</a>
<a name='L330'></a><a href='#L330'>330</a>
<a name='L331'></a><a href='#L331'>331</a>
<a name='L332'></a><a href='#L332'>332</a>
<a name='L333'></a><a href='#L333'>333</a>
<a name='L334'></a><a href='#L334'>334</a>
<a name='L335'></a><a href='#L335'>335</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { dump } from 'js-yaml';
import { SingleToken } from '@/types/tokens';
import { TokenMap } from '../types/TokenMap';
&nbsp;
import { AliasRegex } from '@/constants/AliasRegex';
import { checkAndEvaluateMath } from './math';
import { convertToRgb } from './color';
import { ColorModifierTypes } from '@/constants/ColorModifierTypes';
import { convertModifiedColorToHex } from './convertModifiedColorToHex';
import { getPathName } from './getPathName';
import { ResolveTokenValuesResult } from './tokenHelpers';
&nbsp;
class TokenResolver {
  public tokens: SingleToken[];
&nbsp;
  public tokenMap: TokenMap;
&nbsp;
  public memo: Map&lt;string, ResolveTokenValuesResult&gt;;
&nbsp;
<span class="fstat-no" title="function not covered" >  co</span>nstructor(tokens: SingleToken[]) {
<span class="cstat-no" title="statement not covered" >    this.tokens = tokens;</span>
<span class="cstat-no" title="statement not covered" >    this.tokenMap = new Map();</span>
<span class="cstat-no" title="statement not covered" >    this.memo = new Map();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.populateTokenMap();</span>
  }
&nbsp;
  // Set tokens and populate token map
<span class="fstat-no" title="function not covered" >  pr</span>ivate populateTokenMap(): void {
<span class="cstat-no" title="statement not covered" >    for (const token of this.tokens) {</span>
<span class="cstat-no" title="statement not covered" >      this.tokenMap.set(token.name, token);</span>
    }
  }
&nbsp;
  // When we get new tokens, we need to update the token map
<span class="fstat-no" title="function not covered" >  pu</span>blic setTokens(tokens: SingleToken[]): ResolveTokenValuesResult[] {
<span class="cstat-no" title="statement not covered" >    this.tokens = tokens;</span>
<span class="cstat-no" title="statement not covered" >    this.tokenMap = new Map();</span>
<span class="cstat-no" title="statement not covered" >    this.memo = new Map();</span>
<span class="cstat-no" title="statement not covered" >    this.populateTokenMap();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return this.resolveTokenValues();</span>
  }
&nbsp;
  // Initial function to iterate over all tokens and resolve references
<span class="fstat-no" title="function not covered" >  pu</span>blic resolveTokenValues(): ResolveTokenValuesResult[] {
    const resolvedTokens: ResolveTokenValuesResult[] = <span class="cstat-no" title="statement not covered" >[];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    for (const token of this.tokens) {</span>
      const resolvedValue = <span class="cstat-no" title="statement not covered" >this.resolveReferences(token);</span>
<span class="cstat-no" title="statement not covered" >      if (typeof resolvedValue.value === 'string' &amp;&amp; AliasRegex.test(resolvedValue.value)) {</span>
<span class="cstat-no" title="statement not covered" >        resolvedValue.failedToResolve = true;</span>
      }
<span class="cstat-no" title="statement not covered" >      resolvedTokens.push({</span>
        ...resolvedValue,
        rawValue: token.value,
      } as ResolveTokenValuesResult);
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return resolvedTokens;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  pr</span>ivate isExponentialAndZero(str: string): boolean {
    const regex = <span class="cstat-no" title="statement not covered" >/^[+-]?\d*\.?\d+([eE][+-]?\d+)?$/;</span>
    const numericRegex = <span class="cstat-no" title="statement not covered" >/^[+-]?\d*\.?\d+$/;</span>
&nbsp;
    // Needs to be more than a single zero otherwise "0" will get evaluated incorrectly
    const allZerosRegex = <span class="cstat-no" title="statement not covered" >/^00+$/;</span>
    const leadingZerosRegex = <span class="cstat-no" title="statement not covered" >/^0+[1-9]\d*$/;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return (regex.test(str) &amp;&amp; !numericRegex.test(str)) || (allZerosRegex.test(str) || leadingZerosRegex.test(str));</span>
  }
&nbsp;
  // When we resolve references, we also need to calculate the value of the token, meaning color and math transformations
<span class="fstat-no" title="function not covered" >  pr</span>ivate calculateTokenValue(token: SingleToken, resolvedReferences: Set&lt;string&gt; = <span class="branch-0 cbranch-no" title="branch not covered" >new Set())</span>: SingleToken['value'] | undefined {
    // Calculations only happen on strings.
<span class="cstat-no" title="statement not covered" >    if (typeof token.value === 'string') {</span>
      const couldBeNumberValue = <span class="cstat-no" title="statement not covered" >!this.isExponentialAndZero(token.value) ? checkAndEvaluateMath(token.value) : token.value;</span>
&nbsp;
      // if it's a number, we don't need to do anything else and can return it
<span class="cstat-no" title="statement not covered" >      if (typeof couldBeNumberValue === 'number') {</span>
<span class="cstat-no" title="statement not covered" >        return couldBeNumberValue as SingleToken['value'];</span>
      }
&nbsp;
      // Transform non-conform colors such as rgba({color}, 0.5) to hex
      const rgbColor = <span class="cstat-no" title="statement not covered" >convertToRgb(couldBeNumberValue);</span>
&nbsp;
      // If we have a color modifier, we need to apply it. As we need chained resolution to happen, this needs to be done here.
<span class="cstat-no" title="statement not covered" >      if (typeof token === 'object' &amp;&amp; token?.$extensions?.['studio.tokens']?.modify &amp;&amp; rgbColor) {</span>
<span class="cstat-no" title="statement not covered" >        if (token?.$extensions?.['studio.tokens']?.modify?.type === ColorModifierTypes.MIX) {</span>
          // As we support references in color modifiers, we need to resolve them.
<span class="cstat-no" title="statement not covered" >          return convertModifiedColorToHex(rgbColor, {</span>
            ...token.$extensions?.['studio.tokens']?.modify,
            value: String(this.resolveReferences({ value: token?.$extensions?.['studio.tokens']?.modify?.value } as SingleToken, resolvedReferences)?.value),
            color: String(this.resolveReferences({ value: token?.$extensions?.['studio.tokens']?.modify?.color } as SingleToken, resolvedReferences)?.value) ?? undefined,
          });
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return convertModifiedColorToHex(rgbColor, {</span>
          ...token.$extensions?.['studio.tokens']?.modify,
          value: String(this.resolveReferences({ value: token?.$extensions?.['studio.tokens']?.modify?.value } as SingleToken, resolvedReferences)?.value),
        });
      }
      // If we don't have a color modifier, we can just return the color
<span class="cstat-no" title="statement not covered" >      return rgbColor;</span>
    }
&nbsp;
    // If it's not a string we just return the value.
<span class="cstat-no" title="statement not covered" >    return token.value;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  pu</span>blic resolveReferences(token: SingleToken, resolvedReferences: Set&lt;string&gt; = <span class="branch-0 cbranch-no" title="branch not covered" >new Set())</span>: ResolveTokenValuesResult {
    // We use the name as the memo key, if it exists
    const memoKey = <span class="cstat-no" title="statement not covered" >token.name || undefined;</span>
&nbsp;
    // If we have a cache hit, we can return it
<span class="cstat-no" title="statement not covered" >    if (memoKey &amp;&amp; this.memo.has(memoKey)) {</span>
      const cacheResult = <span class="cstat-no" title="statement not covered" >this.memo.get(memoKey);</span>
<span class="cstat-no" title="statement not covered" >      if (cacheResult) {</span>
<span class="cstat-no" title="statement not covered" >        return cacheResult;</span>
      }
    }
&nbsp;
    let foundToken;
&nbsp;
    // For strings, we need to check if there are any references, as those can only occur in strings
<span class="cstat-no" title="statement not covered" >    if (typeof token.value === 'string') {</span>
      const references = <span class="cstat-no" title="statement not covered" >token.value.toString().match(AliasRegex) || [];</span>
&nbsp;
      let finalValue: SingleToken['value'] = <span class="cstat-no" title="statement not covered" >token.value;</span>
      let resolvedValueWithReferences: SingleToken['value'] | undefined;
&nbsp;
      // Resolve every reference, there could be more than 1, as in "{color.primary} {color.secondary}"
<span class="cstat-no" title="statement not covered" >      for (const reference of references) {</span>
        const path = <span class="cstat-no" title="statement not covered" >getPathName(reference);</span>
&nbsp;
        // We need to avoid circular references, so we check if we already resolved this reference
<span class="cstat-no" title="statement not covered" >        if (resolvedReferences.has(path)) {</span>
<span class="cstat-no" title="statement not covered" >          return {</span>
            ...token,
            rawValue: token.value,
            failedToResolve: true,
          } as ResolveTokenValuesResult;
        }
&nbsp;
        // Users can nest references, so we need to make sure to resolve any nested references first.
        let resolvedPath = <span class="cstat-no" title="statement not covered" >path;</span>
        let matches: boolean = <span class="cstat-no" title="statement not covered" >true;</span>
&nbsp;
        // As long as we have matches, we need to resolve them. This is needed for multiple levels of nesting. Performance will suffer, but that's the user's choice.
<span class="cstat-no" title="statement not covered" >        while (matches !== false) {</span>
          const match = <span class="cstat-no" title="statement not covered" >resolvedPath.match(AliasRegex);</span>
<span class="cstat-no" title="statement not covered" >          matches = Boolean(match?.length);</span>
<span class="cstat-no" title="statement not covered" >          if (!match?.length) <span class="cstat-no" title="statement not covered" >break;</span></span>
&nbsp;
          const nestedTokenName = <span class="cstat-no" title="statement not covered" >getPathName(match[0]);</span>
          const nestedToken = <span class="cstat-no" title="statement not covered" >this.tokenMap.get(nestedTokenName);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          if (nestedToken &amp;&amp; nestedToken.value) {</span>
            const resolvedNestedToken = <span class="cstat-no" title="statement not covered" >this.resolveReferences({ ...nestedToken, name: nestedTokenName } as SingleToken, new Set(resolvedReferences));</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (typeof resolvedNestedToken.value === 'string' || typeof resolvedNestedToken.value === 'number') {</span>
<span class="cstat-no" title="statement not covered" >              resolvedPath = resolvedPath.replace(match[0], resolvedNestedToken.value);</span>
            }
          } else {
<span class="cstat-no" title="statement not covered" >            break;</span>
          }
        }
&nbsp;
        // We have the special case of deep references where we can reference the .fontFamily property of a typography token.
        // For that case, we need to split the path and get the last part, which might be the property name.
        // However, it might not be. If we have a token called "color.primary" and we reference "color.primary.fontFamily", we need to check if "color.primary" exists. If it does, we prefer to return that one.
        // If it doesn't it might be a composite token where we want to return the atomic property
        const propertyPath = <span class="cstat-no" title="statement not covered" >resolvedPath.split('.');</span>
        const propertyName = <span class="cstat-no" title="statement not covered" >propertyPath.pop() as string;</span>
        const tokenNameWithoutLastPart = <span class="cstat-no" title="statement not covered" >propertyPath.join('.');</span>
<span class="cstat-no" title="statement not covered" >        foundToken = this.tokenMap.get(resolvedPath);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (foundToken) {</span>
          // For composite tokens that are being referenced, we need to store the value of the found token so that we have something between raw value of a string and the final resolved token
<span class="cstat-no" title="statement not covered" >          if (typeof token.value === 'string' &amp;&amp; (typeof foundToken.value === 'object' || Array.isArray(foundToken.value))) {</span>
<span class="cstat-no" title="statement not covered" >            resolvedValueWithReferences = foundToken.value;</span>
          }
          // We add the already resolved references to the new set, so we can check for circular references
          const newResolvedReferences = <span class="cstat-no" title="statement not covered" >new Set(resolvedReferences);</span>
<span class="cstat-no" title="statement not covered" >          newResolvedReferences.add(resolvedPath);</span>
          // We initiate a new resolveReferences call, as we need to resolve the references of the reference
          const resolvedTokenValue = <span class="cstat-no" title="statement not covered" >this.resolveReferences({ ...foundToken, name: resolvedPath } as SingleToken, newResolvedReferences);</span>
<span class="cstat-no" title="statement not covered" >          if (resolvedTokenValue.resolvedValueWithReferences) {</span>
<span class="cstat-no" title="statement not covered" >            resolvedValueWithReferences = resolvedTokenValue.resolvedValueWithReferences;</span>
          }
&nbsp;
          // We weren't able to resolve the reference, so we return the token as is, but mark it as failed to resolve
<span class="cstat-no" title="statement not covered" >          if (resolvedTokenValue.value === undefined) {</span>
<span class="cstat-no" title="statement not covered" >            return {</span>
              ...token, value: token.value, rawValue: token.value, failedToResolve: true,
            } as ResolveTokenValuesResult;
          }
&nbsp;
          // We replace the reference with the resolved value if needed
<span class="cstat-no" title="statement not covered" >          if (typeof finalValue === 'string' &amp;&amp; (typeof resolvedTokenValue.value === 'string' || typeof resolvedTokenValue.value === 'number')) {</span>
<span class="cstat-no" title="statement not covered" >            finalValue = finalValue.replace(reference, resolvedTokenValue.value);</span>
          } else <span class="cstat-no" title="statement not covered" >if (resolvedTokenValue.value !== undefined) {</span>
<span class="cstat-no" title="statement not covered" >            finalValue = resolvedTokenValue.value;</span>
          }
        } else {
          // If we didn't find a value, we need to check if we have a composite token
          const tokenValueWithoutProperty = <span class="cstat-no" title="statement not covered" >this.tokenMap.get(tokenNameWithoutLastPart)?.value;</span>
<span class="cstat-no" title="statement not covered" >          if (tokenValueWithoutProperty &amp;&amp; tokenValueWithoutProperty.hasOwnProperty(propertyName)) {</span>
            const propertyTokenValue = <span class="cstat-no" title="statement not covered" >(tokenValueWithoutProperty as Record&lt;string, unknown&gt;)[propertyName];</span>
            const parsedValue = <span class="cstat-no" title="statement not covered" >this.calculateTokenValue({ value: propertyTokenValue } as SingleToken, resolvedReferences);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (parsedValue === undefined) {</span>
<span class="cstat-no" title="statement not covered" >              finalValue = token.value;</span>
            } else {
<span class="cstat-no" title="statement not covered" >              finalValue = (typeof finalValue === 'string' &amp;&amp; (typeof parsedValue === 'string' || typeof parsedValue === 'number')) ? finalValue.replace(reference, parsedValue) : parsedValue;</span>
            }
          } else {
            // Otherwise, we return the token as is, but mark it as failed to resolve
<span class="cstat-no" title="statement not covered" >            return {</span>
              ...token, value: token.value, rawValue: token.value, failedToResolve: true,
            } as ResolveTokenValuesResult;
          }
        }
      }
&nbsp;
      let resolvedToken: ResolveTokenValuesResult;
      // When we have a string or number, we need to check if it's a valid token value.
<span class="cstat-no" title="statement not covered" >      if ((typeof finalValue === 'string' || typeof finalValue === 'number') &amp;&amp; !AliasRegex.test(finalValue)) {</span>
        // We need to calculate the value of the token, as it might be a color or math transformation
        // eslint-disable-next-line @typescript-eslint/no-use-before-define
        const calculated = <span class="cstat-no" title="statement not covered" >this.calculateTokenValue({ ...token, value: finalValue } as SingleToken, resolvedReferences);</span>
<span class="cstat-no" title="statement not covered" >        if (calculated === undefined) {</span>
<span class="cstat-no" title="statement not covered" >          resolvedToken = token;</span>
        } else {
<span class="cstat-no" title="statement not covered" >          resolvedToken = { ...token, value: calculated } as ResolveTokenValuesResult;</span>
        }
      } else {
        // If it's not, we mark it as failed to resolve
        const yamlString = <span class="cstat-no" title="statement not covered" >dump(finalValue);</span>
&nbsp;
        const hasFailingReferences = <span class="cstat-no" title="statement not covered" >AliasRegex.test(yamlString);</span>
&nbsp;
        // We combine the values, add the failing reference indicator.
        // Also, if the originating reference is a string but the resolved value is a composite, we need to add the specific value of the composite token
        // This is needed for cases like border tokens referencing other border tokens where we want to return the raw value of the border color so we can assign styles or variables.
<span class="cstat-no" title="statement not covered" >        resolvedToken = {</span>
          ...token, value: finalValue, rawValue: token.value, ...(hasFailingReferences ? { failedToResolve: true } : {}), ...(typeof resolvedValueWithReferences !== 'undefined' ? { resolvedValueWithReferences } : {}),
        } as ResolveTokenValuesResult;
      }
&nbsp;
      // When we have a string, we store the result in cache
<span class="cstat-no" title="statement not covered" >      if (typeof memoKey === 'string') {</span>
<span class="cstat-no" title="statement not covered" >        this.memo.set(memoKey, resolvedToken);</span>
      }
&nbsp;
      // And then return it
<span class="cstat-no" title="statement not covered" >      return resolvedToken as ResolveTokenValuesResult;</span>
    }
&nbsp;
    // Shadow tokens can be of type array, so we need to resolve those too
<span class="cstat-no" title="statement not covered" >    if (Array.isArray(token.value)) {</span>
      const resolvedArray: any[] = <span class="cstat-no" title="statement not covered" >[];</span>
&nbsp;
      let failedToResolve = <span class="cstat-no" title="statement not covered" >false;</span>
<span class="cstat-no" title="statement not covered" >      for (const item of token.value) {</span>
        // We resolve each individual item, as it might be a reference
        const resolvedItem = <span class="cstat-no" title="statement not covered" >this.resolveReferences({ value: item } as SingleToken, resolvedReferences);</span>
<span class="cstat-no" title="statement not covered" >        if (resolvedItem.failedToResolve) {</span>
<span class="cstat-no" title="statement not covered" >          failedToResolve = true;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        resolvedArray.push(resolvedItem.value);</span>
      }
&nbsp;
      // We bring back the resolved array into the token object, and set failedToResolve on the token if needed
      const resolvedToken = <span class="cstat-no" title="statement not covered" >{</span>
        ...token, value: resolvedArray, rawValue: token.value, ...(failedToResolve ? { failedToResolve } : {}),
      } as ResolveTokenValuesResult;
      // We save back to cache
<span class="cstat-no" title="statement not covered" >      if (typeof memoKey === 'string') {</span>
<span class="cstat-no" title="statement not covered" >        this.memo.set(memoKey, resolvedToken);</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      resolvedToken.resolvedValueWithReferences = token.value;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      return resolvedToken;</span>
    }
&nbsp;
    // If we have an object (typography, border, shadow, compositions), we need to resolve each property
<span class="cstat-no" title="statement not covered" >    if (typeof token.value === 'object' &amp;&amp; token.value !== null) {</span>
      const resolvedObject: { [key: string]: any } = <span class="cstat-no" title="statement not covered" >{};</span>
&nbsp;
      let failedToResolve = <span class="cstat-no" title="statement not covered" >false;</span>
<span class="cstat-no" title="statement not covered" >      for (const key of Object.keys(token.value)) {</span>
<span class="cstat-no" title="statement not covered" >        if (Object.prototype.hasOwnProperty.call(token.value, key)) {</span>
          const propertyTokenValue = <span class="cstat-no" title="statement not covered" >(token.value as Record&lt;string, unknown&gt;)[key];</span>
          const resolvedValue = <span class="cstat-no" title="statement not covered" >this.resolveReferences({ value: propertyTokenValue } as SingleToken, resolvedReferences);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          if (resolvedValue.failedToResolve) {</span>
<span class="cstat-no" title="statement not covered" >            failedToResolve = true;</span>
          }
          // Note: This is technically incorrect. We should not be expecting this, but we need to mark those tokens that are referencing an object even though they should be expecting a string as invalid, e only have failedToResolve today. See https://github.com/tokens-studio/figma-plugin/issues/2450
<span class="cstat-no" title="statement not covered" >          if (typeof resolvedValue.value === 'object' &amp;&amp; key in resolvedValue.value) {</span>
<span class="cstat-no" title="statement not covered" >            failedToResolve = true;</span>
          }
<span class="cstat-no" title="statement not covered" >          resolvedObject[key] = resolvedValue.value;</span>
        }
      }
&nbsp;
      const resolvedToken = <span class="cstat-no" title="statement not covered" >{ ...token, value: resolvedObject, ...(failedToResolve ? { failedToResolve } : {}) } as ResolveTokenValuesResult;</span>
      // If we have a value, we set it back to cache
<span class="cstat-no" title="statement not covered" >      if (typeof memoKey === 'string') {</span>
<span class="cstat-no" title="statement not covered" >        this.memo.set(memoKey, resolvedToken);</span>
      }
&nbsp;
      // For all composite tokens we add the resolved value with references to the token.
      // technically for composites this is not needed, but then we can rely on this one property to contain the original value
<span class="cstat-no" title="statement not covered" >      resolvedToken.resolvedValueWithReferences = token.value;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      return resolvedToken;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return token;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  pu</span>blic get(tokenName: string): SingleToken | undefined {
<span class="cstat-no" title="statement not covered" >    return this.tokenMap.get(tokenName);</span>
  }
}
&nbsp;
const defaultTokenResolver = <span class="cstat-no" title="statement not covered" >new TokenResolver([]);</span>
&nbsp;
export { defaultTokenResolver };
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-05-28T06:47:54.714Z
            </div>
        <script src="../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../sorter.js"></script>
        <script src="../../block-navigation.js"></script>
    </body>
</html>
    